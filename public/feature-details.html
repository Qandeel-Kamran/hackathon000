<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Details - Physical AI & Humanoid Robotics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .feature-detail-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .feature-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 3rem 0 1.5rem;
            margin-top: 3rem;
        }

        .code-block {
            background-color: #f4f4f4;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .highlight-box {
            background-color: rgba(52, 152, 219, 0.1);
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
        }

        .interactive-element {
            background-color: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
            padding: 1rem;
            margin: 1rem 0;
        }

        .sub-content-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sub-content-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .sub-content-card.border-primary {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .code-block {
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-block pre {
            margin: 0;
            background: none;
        }

        .code-block code {
            background: none;
            padding: 0;
            border: none;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <i class="fas fa-robot me-2"></i>
                <span class="fw-bold">Physical AI Book</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chapters.html"><i class="fas fa-book me-1"></i> Chapters</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="features.html"><i class="fas fa-star me-1"></i> Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html"><i class="fas fa-info-circle me-1"></i> About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-3" id="feature-title">Feature Details</h1>
            <p class="lead mb-4" id="feature-subtitle">Explore the interactive learning features</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Feature Detail Card -->
                <div class="feature-detail-card">
                    <div class="text-center mb-4">
                        <div class="feature-icon mx-auto" id="feature-icon">
                            <i class="fas fa-code"></i>
                        </div>
                    </div>

                    <div id="feature-content">
                        <!-- Feature content will be loaded dynamically -->
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading feature details...</p>
                        </div>
                    </div>
                </div>

                <!-- Related Resources Section -->
                <div class="feature-section">
                    <h3 class="text-primary mb-3"><i class="fas fa-lightbulb me-2"></i>Related Resources</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="highlight-box">
                                <h5><i class="fas fa-book me-2"></i>Chapter References</h5>
                                <p>Find related content in the textbook chapters that complement this feature.</p>
                                <button class="btn btn-outline-primary btn-sm" onclick="showRelatedChapters()">View Related Chapters</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="highlight-box">
                                <h5><i class="fas fa-code me-2"></i>Code Examples</h5>
                                <p>Access practical code examples that demonstrate this feature in action.</p>
                                <button class="btn btn-outline-success btn-sm" onclick="showCodeExamples()">View Code Examples</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Demo Section -->
                <div class="feature-section">
                    <h3 class="text-primary mb-3"><i class="fas fa-mouse-pointer me-2"></i>Interactive Demo</h3>
                    <div class="interactive-element">
                        <p><i class="fas fa-info-circle me-2"></i>This feature includes interactive elements that allow you to experiment with the concepts in real-time. Try adjusting parameters and see how they affect the system behavior.</p>
                        <div id="interactive-demo">
                            <!-- Interactive demo will be loaded based on feature -->
                        </div>
                    </div>
                </div>

                <!-- Code Examples Section -->
                <div class="feature-section" id="code-examples-section" style="display: none;">
                    <h3 class="text-primary mb-3"><i class="fas fa-code me-2"></i>Code Examples</h3>
                    <div id="code-examples-content">
                        <!-- Code examples will be loaded based on feature -->
                    </div>
                </div>

                <!-- Sub-content Sections -->
                <div class="feature-section">
                    <h3 class="text-primary mb-3"><i class="fas fa-book-open me-2"></i>Sub-content Topics</h3>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 sub-content-card" onclick="showSubContent('theory', this)">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="fas fa-theater-masks me-2"></i>Theory</h5>
                                    <p class="card-text">Fundamental concepts and mathematical foundations behind this feature.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 sub-content-card" onclick="showSubContent('implementation', this)">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="fas fa-code me-2"></i>Implementation</h5>
                                    <p class="card-text">Practical code examples and implementation details for this feature.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 sub-content-card" onclick="showSubContent('examples', this)">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="fas fa-lightbulb me-2"></i>Examples</h5>
                                    <p class="card-text">Real-world examples and use cases demonstrating this feature.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 sub-content-card" onclick="showSubContent('exercises', this)">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="fas fa-tasks me-2"></i>Exercises</h5>
                                    <p class="card-text">Practice problems and exercises to reinforce your understanding.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sub-content Detail Modal -->
                <div class="modal fade" id="subContentModal" tabindex="-1" aria-labelledby="subContentModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="subContentModalLabel">Sub-content Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body" id="subContentModalBody">
                                <!-- Sub-content details will be loaded here -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="goToRelatedContent()">Explore More</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Physical AI Book</h5>
                    <p>Interactive learning platform for Physical AI and Humanoid Robotics concepts.</p>
                </div>
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-light">Home</a></li>
                        <li><a href="chapters.html" class="text-light">Chapters</a></li>
                        <li><a href="features.html" class="text-light">Features</a></li>
                        <li><a href="about.html" class="text-light">About</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Connect</h5>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-light"><i class="fab fa-github fa-2x"></i></a>
                        <a href="#" class="text-light"><i class="fab fa-twitter fa-2x"></i></a>
                        <a href="#" class="text-light"><i class="fab fa-linkedin fa-2x"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4 bg-light">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 Physical AI Book. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Floating Chat Button -->
    <div class="floating-chat-btn" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000;">
        <button id="chat-toggle-btn" class="btn btn-primary btn-lg rounded-circle shadow" style="width: 60px; height: 60px; border-radius: 50% !important;" onclick="toggleChat()">
            <i class="fas fa-question-circle fa-2x"></i>
        </button>
    </div>

    <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-end">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-question-circle fa-2x me-3"></i>
                        <div>
                            <h5 class="modal-title mb-0" id="chatModalLabel">Book Assistant</h5>
                            <small class="opacity-75">Ask me anything about robotics!</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0">
                        <div class="col-8">
                            <div id="chat-messages-modal" class="p-3" style="height: 400px; overflow-y: auto; background-color: #f8f9fa;">
                                <div class="message ai-message mb-3">
                                    <div class="d-flex align-items-start">
                                        <div class="avatar bg-primary rounded-circle p-2 me-3">
                                            <i class="fas fa-question-circle text-white"></i>
                                        </div>
                                        <div class="bg-light rounded p-3 flex-grow-1">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">Book Assistant</small>
                                                <small class="text-muted">Just now</small>
                                            </div>
                                            <p class="mb-0 mt-1">Hello! I'm your Book Assistant for Physical AI and Humanoid Robotics. Feel free to ask me any questions about the content, concepts, or applications in robotics and AI.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-4 border-start bg-light">
                            <div class="p-3">
                                <h6 class="mb-3 text-primary"><i class="fas fa-lightbulb me-2"></i>Quick Questions</h6>
                                <div class="d-grid gap-2 mb-3">
                                    <button class="btn btn-outline-primary btn-sm" onclick="sendQuickMessageModal('Explain forward kinematics')">Forward Kinematics</button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="sendQuickMessageModal('How does PID control work in robotics?')">PID Control</button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="sendQuickMessageModal('What is the difference between holonomic and non-holonomic robots?')">Robot Types</button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="sendQuickMessageModal('Explain ZMP in humanoid robotics')">ZMP in Humanoids</button>
                                </div>
                                <div class="bg-white rounded p-2 mb-2">
                                    <small class="text-muted">ðŸ’¡ Ask about textbook chapters!</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="input-group">
                        <input type="text" id="message-input-modal" class="form-control" placeholder="Ask a question about Physical AI, robotics, or any chapter content..." onkeypress="handleMessageKeyPressModal(event)">
                        <button class="btn btn-primary" type="button" onclick="sendMessageModal()">
                            <i class="fas fa-paper-plane me-1"></i> Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load feature details from URL parameter
        function loadFeatureDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const featureId = urlParams.get('id');
            const featureTitle = urlParams.get('title');
            const featureIcon = urlParams.get('icon');
            const featureDetails = urlParams.get('details');

            if (featureId && featureTitle && featureIcon) {
                document.getElementById('feature-title').textContent = featureTitle;
                document.getElementById('feature-icon').innerHTML = `<i class="${featureIcon}"></i>`;

                // Decode and display feature details
                const decodedDetails = decodeURIComponent(featureDetails || '');
                document.getElementById('feature-content').innerHTML = `
                    <h2 class="text-primary mb-4">${featureTitle}</h2>
                    <div class="lead mb-4">${decodedDetails}</div>

                    <div class="highlight-box">
                        <h5><i class="fas fa-graduation-cap me-2"></i>Learning Objectives</h5>
                        <ul>
                            <li>Understand the core concepts and principles</li>
                            <li>Learn practical implementation techniques</li>
                            <li>Apply knowledge to real-world robotics problems</li>
                            <li>Connect with related textbook content</li>
                        </ul>
                    </div>

                    <div class="interactive-element">
                        <h5><i class="fas fa-cogs me-2"></i>How to Use This Feature</h5>
                        <p>This interactive feature allows you to:</p>
                        <ul>
                            <li>Experiment with different parameters</li>
                            <li>Visualize complex concepts in action</li>
                            <li>Test your understanding through interactive exercises</li>
                            <li>Connect theoretical knowledge with practical applications</li>
                        </ul>
                    </div>

                    <div class="mt-4">
                        <button class="btn btn-primary btn-lg me-2" onclick="goToChapter()">
                            <i class="fas fa-book me-2"></i>Related Chapters
                        </button>
                        <button class="btn btn-outline-primary btn-lg" onclick="goToFeatures()">
                            <i class="fas fa-star me-2"></i>Back to Features
                        </button>
                    </div>
                `;

                // Load feature-specific content including code examples
                loadFeatureSpecificContent(featureId);
            } else {
                // Fallback if no feature ID is provided
                document.getElementById('feature-content').innerHTML = `
                    <h2 class="text-danger">Feature Not Found</h2>
                    <p class="lead">The requested feature could not be found. Please go back to the features page to select a feature.</p>
                    <a href="features.html" class="btn btn-primary">Back to Features</a>
                `;
            }
        }

        // Load feature-specific content including code examples
        function loadFeatureSpecificContent(featureId) {
            const codeExamplesSection = document.getElementById('code-examples-section');
            const codeExamplesContent = document.getElementById('code-examples-content');

            // Define feature-specific content
            const featureContent = {
                'interactive-code': {
                    title: 'Interactive Code Examples',
                    examples: [
                        {
                            title: 'Forward Kinematics Example',
                            language: 'python',
                            code: `import numpy as np

def forward_kinematics(joint_angles):
    """Calculate end-effector position from joint angles"""
    # DH parameters for a simple 2-DOF arm
    l1, l2 = 1.0, 0.8  # link lengths
    theta1, theta2 = joint_angles

    # Calculate end-effector position
    x = l1 * np.cos(theta1) + l2 * np.cos(theta1 + theta2)
    y = l1 * np.sin(theta1) + l2 * np.sin(theta1 + theta2)

    return [x, y]

# Example usage
angles = [np.pi/4, np.pi/6]  # 45Â° and 30Â°
position = forward_kinematics(angles)
print(f"End-effector position: {position}")`
                        },
                        {
                            title: 'PID Controller Example',
                            language: 'python',
                            code: `class PIDController:
    def __init__(self, kp, ki, kd):
        self.kp = kp  # Proportional gain
        self.ki = ki  # Integral gain
        self.kd = kd  # Derivative gain
        self.prev_error = 0
        self.integral = 0

    def compute(self, setpoint, measured_value, dt):
        error = setpoint - measured_value

        # Proportional term
        p_term = self.kp * error

        # Integral term
        self.integral += error * dt
        i_term = self.ki * self.integral

        # Derivative term
        derivative = (error - self.prev_error) / dt
        d_term = self.kd * derivative

        # Store error for next iteration
        self.prev_error = error

        # Calculate output
        output = p_term + i_term + d_term
        return output

# Example usage
pid = PIDController(kp=1.0, ki=0.1, kd=0.05)
control_output = pid.compute(setpoint=1.0, measured_value=0.5, dt=0.01)`
                        }
                    ]
                },
                'system-architecture': {
                    title: 'System Architecture',
                    examples: [
                        {
                            title: 'ROS 2 Node Example',
                            language: 'python',
                            code: `import rclpy
from rclpy.node import Node
from std_msgs.msg import String

class MinimalPublisher(Node):
    def __init__(self):
        super().__init__('minimal_publisher')
        self.publisher_ = self.create_publisher(String, 'topic', 10)
        timer_period = 0.5  # seconds
        self.timer = self.create_timer(timer_period, self.timer_callback)
        self.i = 0

    def timer_callback(self):
        msg = String()
        msg.data = 'Hello World: %d' % self.i
        self.publisher_.publish(msg)
        self.get_logger().info('Publishing: "%s"' % msg.data)
        self.i += 1

def main(args=None):
    rclpy.init(args=args)
    minimal_publisher = MinimalPublisher()
    rclpy.spin(minimal_publisher)
    minimal_publisher.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()`
                        },
                        {
                            title: 'ROS 2 Topic Communication',
                            language: 'bash',
                            code: `# Create a publisher node
ros2 run demo_nodes_cpp talker

# In another terminal, create a subscriber
ros2 run demo_nodes_cpp listener

# Check active topics
ros2 topic list

# Echo messages from a topic
ros2 topic echo /chatter std_msgs/msg/String`
                        },
                        {
                            title: 'ROS 2 Service Example',
                            language: 'python',
                            code: `# Service server example
import rclpy
from rclpy.node import Node
from example_interfaces.srv import AddTwoInts

class MinimalService(Node):
    def __init__(self):
        super().__init__('minimal_service')
        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)

    def add_two_ints_callback(self, request, response):
        response.sum = request.a + request.b
        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))
        return response

def main(args=None):
    rclpy.init(args=args)
    minimal_service = MinimalService()
    rclpy.spin(minimal_service)
    rclpy.shutdown()`
                        }
                    ]
                },
                'smart-search': {
                    title: 'Smart Content Search',
                    examples: [
                        {
                            title: 'Search Implementation',
                            language: 'javascript',
                            code: `// Search functionality example
class SmartSearch {
    constructor(content) {
        this.content = content;
        this.index = this.createSearchIndex();
    }

    createSearchIndex() {
        // Create an index for faster searching
        const index = {};
        this.content.forEach((item, idx) => {
            const words = item.text.toLowerCase().split(/\\W+/);
            words.forEach(word => {
                if (!index[word]) index[word] = [];
                index[word].push(idx);
            });
        });
        return index;
    }

    search(query) {
        const terms = query.toLowerCase().split(/\\W+/);
        const results = [];

        terms.forEach(term => {
            if (this.index[term]) {
                this.index[term].forEach(idx => {
                    if (!results.includes(idx)) {
                        results.push(idx);
                    }
                });
            }
        });

        return results.map(idx => this.content[idx]);
    }
}

// Usage
const searchEngine = new SmartSearch(contentData);
const results = searchEngine.search('forward kinematics');`
                        }
                    ]
                },
                'math-visualization': {
                    title: 'Mathematical Visualization',
                    examples: [
                        {
                            title: 'Rotation Matrix Example',
                            language: 'python',
                            code: `import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

def rotation_matrix_z(angle):
    """Create a rotation matrix around Z-axis"""
    cos_a = np.cos(angle)
    sin_a = np.sin(angle)
    return np.array([
        [cos_a, -sin_a, 0],
        [sin_a, cos_a, 0],
        [0, 0, 1]
    ])

def visualize_rotation():
    # Original point
    point = np.array([1, 0, 0])

    # Apply rotation
    angle = np.pi / 3  # 60 degrees
    rot_matrix = rotation_matrix_z(angle)
    rotated_point = rot_matrix @ point

    # Plot
    fig = plt.figure()
    ax = fig.add_subplot(111, projection='3d')

    ax.quiver(0, 0, 0, point[0], point[1], point[2], color='r', label='Original')
    ax.quiver(0, 0, 0, rotated_point[0], rotated_point[1], rotated_point[2], color='b', label='Rotated')

    ax.set_xlim([-1.5, 1.5])
    ax.set_ylim([-1.5, 1.5])
    ax.set_zlim([-1.5, 1.5])
    ax.legend()
    plt.show()

visualize_rotation()`
                        }
                    ]
                },
                'smart-bookmarks': {
                    title: 'Smart Bookmarks',
                    examples: [
                        {
                            title: 'Bookmark System',
                            language: 'javascript',
                            code: `class SmartBookmarks {
    constructor() {
        this.bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
    }

    addBookmark(chapter, section, note = '') {
        const bookmark = {
            id: Date.now(),
            chapter: chapter,
            section: section,
            note: note,
            timestamp: new Date().toISOString(),
            progress: this.getCurrentProgress()
        };

        this.bookmarks.push(bookmark);
        this.saveBookmarks();
        return bookmark;
    }

    getBookmarksByChapter(chapter) {
        return this.bookmarks.filter(b => b.chapter === chapter);
    }

    saveBookmarks() {
        localStorage.setItem('bookmarks', JSON.stringify(this.bookmarks));
    }

    getCurrentProgress() {
        // Get current reading progress
        return localStorage.getItem('readingProgress') || '0%';
    }
}

// Usage
const bookmarks = new SmartBookmarks();
bookmarks.addBookmark('Chapter 3', '3.2 Forward Kinematics', 'Important concept for robot control');`
                        }
                    ]
                }
            };

            // Show code examples section if feature has examples
            if (featureContent[featureId]) {
                const featureData = featureContent[featureId];
                let examplesHtml = '';

                if (featureData.examples && featureData.examples.length > 0) {
                    featureData.examples.forEach(example => {
                        examplesHtml += `
                        <div class="mb-4">
                            <h5 class="text-secondary">${example.title}</h5>
                            <div class="code-block">
                                <pre><code class="language-${example.language}">${escapeHtml(example.code)}</code></pre>
                            </div>
                        </div>
                        `;
                    });

                    codeExamplesContent.innerHTML = examplesHtml;
                    codeExamplesSection.style.display = 'block';
                } else {
                    codeExamplesContent.innerHTML = '<p>No code examples available for this feature.</p>';
                    codeExamplesSection.style.display = 'block';
                }
            } else {
                codeExamplesContent.innerHTML = '<p>No code examples available for this feature.</p>';
                codeExamplesSection.style.display = 'none';
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function showRelatedChapters() {
            alert('This feature would show related chapters from the textbook that complement this learning feature.');
        }

        function showCodeExamples() {
            alert('This feature would provide access to practical code examples demonstrating the concepts in action.');
        }

        function goToChapter() {
            window.location.href = 'chapters.html';
        }

        function goToFeatures() {
            window.location.href = 'features.html';
        }

        // Modal chat functionality (copy from main page)
        let chatModal = null;

        function toggleChat() {
            const modalElement = document.getElementById('chatModal');
            chatModal = chatModal || new bootstrap.Modal(modalElement);

            // If modal is hidden, show it; if shown, hide it
            const modal = bootstrap.Modal.getInstance(modalElement) || chatModal;
            if (modalElement.classList.contains('show')) {
                modal.hide();
            } else {
                modal.show();
            }
        }

        function addMessageToChatModal(sender, message, isUser = false) {
            const chatMessages = document.getElementById('chat-messages-modal');

            const messageElement = document.createElement('div');
            messageElement.className = `message ${isUser ? 'user-message' : 'ai-message'} mb-3`;

            const avatarClass = isUser ? 'bg-success' : 'bg-primary';
            const senderName = isUser ? 'You' : 'Book Assistant';
            const icon = isUser ? 'fas fa-user' : 'fas fa-question-circle';

            messageElement.innerHTML = `
                <div class="d-flex align-items-start">
                    <div class="avatar ${avatarClass} rounded-circle p-2 me-3">
                        <i class="${icon} text-white"></i>
                    </div>
                    <div class="${isUser ? 'bg-success text-white' : 'bg-light'} rounded p-3 flex-grow-1">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">${senderName}</small>
                            <small class="text-muted">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                        </div>
                        <p class="mb-0 mt-1">${message}</p>
                    </div>
                </div>
            `;

            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessageModal() {
            const input = document.getElementById('message-input-modal');
            const message = input.value.trim();

            if (!message) return;

            // Add user message to chat
            addMessageToChatModal('You', message, true);
            input.value = '';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();

                if (data.success) {
                    addMessageToChatModal('Book Assistant', data.response, false);
                } else {
                    addMessageToChatModal('Book Assistant', 'Sorry, I encountered an error processing your request. Please try again.', false);
                }
            } catch (error) {
                console.error('Error sending message:', error);
                addMessageToChatModal('Book Assistant', 'Sorry, I encountered an error processing your request. Please try again.', false);
            }
        }

        function sendQuickMessageModal(message) {
            document.getElementById('message-input-modal').value = message;
            sendMessageModal();
        }

        function handleMessageKeyPressModal(event) {
            if (event.key === 'Enter') {
                sendMessageModal();
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadFeatureDetails();

            // Set up the initial message
            if (document.getElementById('chat-messages-modal').children.length === 0) {
                addMessageToChatModal('Book Assistant', "Hello! I'm your Book Assistant for Physical AI and Humanoid Robotics. Feel free to ask me any questions about the content, concepts, or applications in robotics and AI.", false);
            }
        });

        // Function to show sub-content details
        function showSubContent(contentType, element) {
            // Remove active class from all cards
            document.querySelectorAll('.sub-content-card').forEach(card => {
                card.classList.remove('border-primary', 'border-2');
            });

            // Add active class to clicked card
            element.classList.add('border-primary', 'border-2');

            let title, content;

            switch(contentType) {
                case 'theory':
                    title = 'Theoretical Foundations';
                    content = `
                        <div class="highlight-box">
                            <h5><i class="fas fa-theater-masks me-2"></i>Fundamental Concepts</h5>
                            <p>This section covers the mathematical and theoretical foundations of the feature. It includes:</p>
                            <ul>
                                <li>Core principles and definitions</li>
                                <li>Mathematical formulations</li>
                                <li>Derivations and proofs</li>
                                <li>Relationships to other concepts</li>
                            </ul>
                        </div>
                        <div class="mt-3">
                            <h6>Key Equations:</h6>
                            <div class="code-block">
                                // Mathematical formulas and equations relevant to this feature
                                // Would include LaTeX or MathML for complex equations
                            </div>
                        </div>
                    `;
                    break;
                case 'implementation':
                    title = 'Implementation Details';
                    content = `
                        <div class="highlight-box">
                            <h5><i class="fas fa-code me-2"></i>Code Implementation</h5>
                            <p>Practical implementation details and code examples:</p>
                            <ul>
                                <li>Step-by-step implementation guide</li>
                                <li>Code snippets in Python/C++</li>
                                <li>ROS 2 integration examples</li>
                                <li>Best practices and common pitfalls</li>
                            </ul>
                        </div>
                        <div class="mt-3">
                            <h6>Sample Code:</h6>
                            <div class="code-block">
// Example implementation code
def example_function():
    # Implementation details
    pass
                            </div>
                        </div>
                    `;
                    break;
                case 'examples':
                    title = 'Real-world Examples';
                    content = `
                        <div class="highlight-box">
                            <h5><i class="fas fa-lightbulb me-2"></i>Practical Examples</h5>
                            <p>Real-world applications and use cases:</p>
                            <ul>
                                <li>Case studies from robotics research</li>
                                <li>Industrial applications</li>
                                <li>Research paper references</li>
                                <li>Performance benchmarks</li>
                            </ul>
                        </div>
                        <div class="mt-3">
                            <h6>Application Scenarios:</h6>
                            <div class="interactive-element">
                                <p>Example scenarios where this feature is commonly used in humanoid robotics and physical AI applications.</p>
                            </div>
                        </div>
                    `;
                    break;
                case 'exercises':
                    title = 'Practice Exercises';
                    content = `
                        <div class="highlight-box">
                            <h5><i class="fas fa-tasks me-2"></i>Learning Exercises</h5>
                            <p>Practice problems to reinforce understanding:</p>
                            <ul>
                                <li>Conceptual questions</li>
                                <li>Implementation challenges</li>
                                <li>Simulation exercises</li>
                                <li>Analysis problems</li>
                            </ul>
                        </div>
                        <div class="mt-3">
                            <h6>Exercise:</h6>
                            <div class="interactive-element">
                                <p>Try implementing this feature in a simple robot simulation or analyze its behavior under different conditions.</p>
                                <button class="btn btn-outline-primary btn-sm mt-2">Start Exercise</button>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    title = 'Sub-content Details';
                    content = '<p>Detailed information about this sub-topic will be displayed here.</p>';
            }

            // Update modal content
            document.getElementById('subContentModalLabel').innerHTML = `<i class="fas fa-book-open me-2"></i>${title}`;
            document.getElementById('subContentModalBody').innerHTML = content;

            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('subContentModal'));
            modal.show();
        }

        function goToRelatedContent() {
            // This would navigate to related chapters or content
            alert('This would take you to related textbook content and exercises.');
        }

        // Make functions available globally
        window.toggleChat = toggleChat;
        window.sendMessageModal = sendMessageModal;
        window.sendQuickMessageModal = sendQuickMessageModal;
        window.handleMessageKeyPressModal = handleMessageKeyPressModal;
        window.addMessageToChatModal = addMessageToChatModal;
        window.showRelatedChapters = showRelatedChapters;
        window.showCodeExamples = showCodeExamples;
        window.goToChapter = goToChapter;
        window.goToFeatures = goToFeatures;
        window.showSubContent = showSubContent;
        window.goToRelatedContent = goToRelatedContent;
    </script>
</body>
</html>